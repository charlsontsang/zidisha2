<?xml version="1.0" encoding="UTF-8"?>
<database name="zidisha" defaultIdMethod="native" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
          xsi:noNamespaceSchemaLocation="http://xsd.propelorm.org/1.6/database.xsd" namespace="Zidisha\">
    <table name="users" phpName="User" namespace="User">
        <column name="id" type="INTEGER" required="true" primaryKey="true" autoIncrement="true"/>
        <column name="username" type="VARCHAR" size="20" required="true" />
        <column name="email" type="VARCHAR" size="100" required="true" />
        <column name="password" type="VARCHAR" size="60" required="false" />
        <column name="profile_picture_id" type="INTEGER" required="false"></column>
        <column name="facebook_id" type="BIGINT" required="false" />
        <column name="remember_token" type="VARCHAR" size="100" required="false" />
        <column name="role" type="ENUM" valueSet="lender, borrower, admin" />
        <column name="last_login_at" type="TIMESTAMP" required="true" />
        <behavior name="timestampable" />
        <foreign-key foreignTable="uploads" phpName="ProfilePicture">
            <reference local="profile_picture_id" foreign="id"/>
        </foreign-key>
        <unique>
            <unique-column name="username" />
        </unique>
        <unique>
            <unique-column name="email"></unique-column>
        </unique>
    </table>

    <table name="loan_categories" phpName="Category" namespace="Loan">
        <column name="id" type="INTEGER" required="true" primaryKey="true" autoIncrement="true"/>
        <column name="name" type="VARCHAR" size="100" required="true"/>
        <column name="slug" type="VARCHAR" size="100" required="true"/>
        <column name="what_description" type="LONGVARCHAR" required="false"/>
        <column name="why_description" type="LONGVARCHAR" required="false"/>
        <column name="how_description" type="LONGVARCHAR" required="false"/>
        <column name="admin_only" type="BOOLEAN" defaultValue="FALSE"/>
        <behavior name="timestampable"/>
        <behavior name="sortable"/>
    </table>

    <table name="countries" phpName="Country" namespace="Country">
        <column name="id" type="INTEGER" required="true" primaryKey="true" autoIncrement="true"/>
        <column name="name" type="VARCHAR" size="100" required="true"/>
        <column name="slug" type="VARCHAR" size="100" required="true"/>
        <column name="capital" type="VARCHAR" size="100"/>
        <column name="continent_code" type="VARCHAR" size="2" required="true"/>
        <column name="country_code" type="VARCHAR" size="2" required="true"/>
        <column name="dialing_code" type="VARCHAR" size="4" required="true"/>
        <column name="currency_code" type="VARCHAR" size="3" required="true"/>
        <column name="borrower_country" type="BOOLEAN"/>
        <column name="registration_fee" type="DECIMAL" size="10" scale="2" defaultValue="0.00" phpType="string"/>
        <index name="name">
            <index-column name="name" />
        </index>
        <index name="country_code">
            <index-column name="country_code" />
        </index>
        <behavior name="timestampable"/>
    </table>

    <table name="loans" phpName="Loan" namespace="Loan">
        <column name="id" type="INTEGER" required="true" primaryKey="true" autoIncrement="true"/>
        <column name="borrower_id" type="INTEGER" primaryKey="true"/>"
        <column name="summary" type="LONGVARCHAR"/>
        <column name="description" type="LONGVARCHAR"/>
        <column name="native_amount" type="DECIMAL" size="10" scale="2" phpType="string"/>
        <column name="installment_amount" type="DECIMAL" size="10" scale="2" phpType="string"/>
        <column name="installment_day" type="INTEGER"/>
        <column name="interest_rate" type="DECIMAL" size="5" scale="2" phpType="string"/>
        <column name="final_interest_rate" type="DECIMAL" size="5" scale="2" phpType="string"/>
        <column name="loan_category_id" type="INTEGER" required="true"/>
        <column name="status" type="ENUM" valueSet="0, 1, 2, 3, 5, 6, 7"/>
        <column name="application_date" type="TIMESTAMP" required="true"/>
        <column name="accepted_date" type="TIMESTAMP"/>
        <column name="expired_date" type="TIMESTAMP"/>
        <column name="registration_fee_rate" type="DECIMAL" size="5" scale="2" phpType="string"/>
        <column name="amount" type="DECIMAL" size="10" scale="2"  required="true" phpType="string"/>
        <column name="disbursed_amount" type="DECIMAL" size="10" scale="2" phpType="string"/>
        <column name="disbursed_date" type="TIMESTAMP"/>
        <column name="extra_days" type="INTEGER"/>
        <column name="service_fee_rate" type="DECIMAL" size="5" scale="2" phpType="string"/>
        <column name="currency_code" type="VARCHAR" size="3" required="true"/>
        <column name="installment_period" type="ENUM" valueSet="monthly, weekly"/>
        <column name="period" type="INTEGER"/>
        <behavior name="timestampable"/>
        <foreign-key foreignTable="loan_categories">
            <reference local="loan_category_id" foreign="id" />
        </foreign-key>
        <foreign-key foreignTable="borrowers" phpName="Borrower">
            <reference local="borrower_id" foreign="id"/>
        </foreign-key>
    </table>

    <table name="loan_bids" phpName="Bid" namespace="Loan">
        <column name="id" type="INTEGER" required="true" primaryKey="true" autoIncrement="true"/>
        <column name="loan_id" type="INTEGER" required="true"/>
        <column name="lender_id" type="INTEGER" required="true"/>
        <column name="borrower_id" type="INTEGER" required="true"/>
        <column name="bid_amount" type="DECIMAL" size="10" scale="2" required="true" phpType="string"/>
        <column name="interest_rate" type="DECIMAL" size="5" scale="2" required="true"/>
        <column name="active" type="TINYINT" size="1" required="true" defaultValue="0"/>
        <column name="accepted_amount" type="DECIMAL" size="10" scale="2" required="true" defaultValue="0.00" phpType="string"/>
        <column name="bid_date" type="TIMESTAMP" required="true"/>
        <behavior name="timestampable" />
        <column name="lender_invite_credit" type="TINYINT" size="1" required="true" defaultValue="0"/>
        <foreign-key foreignTable="lenders">
            <reference local="lender_id" foreign="id"/>
        </foreign-key>
        <foreign-key foreignTable="borrowers">
            <reference local="borrower_id" foreign="id"/>
        </foreign-key>
        <foreign-key foreignTable="loans">
            <reference local="loan_id" foreign="id"/>
        </foreign-key>
    </table>

    <table name="password_reminders" phpName="PasswordReminder" namespace="PasswordReminder">
        <column name="email" type="VARCHAR" size="100" required="true" />
        <column name="token" type="VARCHAR" size="100" required="true" />
        <behavior name="timestampable" />
        <index name="email">
            <index-column name="email" />
        </index>
        <index name="token">
            <index-column name="token" />
        </index>
    </table>
    
    <table name="lenders" phpName="Lender" namespace="Lender">
        <column name="id" type="INTEGER" primaryKey="true" />
        <column name="country_id" type="INTEGER" required="true"/>
        <column name="first_name" type="VARCHAR" size="50" required="false" />
        <column name="last_name" type="VARCHAR" size="50" required="false" />
        <behavior name="timestampable" />
        <foreign-key foreignTable="users">
            <reference local="id" foreign="id"/>
        </foreign-key>
        <foreign-key foreignTable="countries">
            <reference local="country_id" foreign="id"/>
        </foreign-key>
    </table>

    <table name="borrowers" phpName="Borrower" namespace="Borrower">
        <column name="id" type="INTEGER" primaryKey="true" />
        <column name="country_id" type="INTEGER" required="true"/>
        <column name="first_name" type="VARCHAR" size="50" required="true" />
        <column name="last_name" type="VARCHAR" size="50" required="true" />
        <column name="active_loan_id" type="INTEGER"/>
        <column name="loan_status" type="ENUM" valueSet="0, 1, 2, 3, 4, 5, 6, 7" defaultValue="4"/>
        <behavior name="timestampable" />
        <foreign-key foreignTable="users">
            <reference local="id" foreign="id"/>
        </foreign-key>
        <foreign-key foreignTable="countries">
            <reference local="country_id" foreign="id"/>
        </foreign-key>
        <foreign-key foreignTable="loans" phpName="ActiveLoan">
            <reference local="active_loan_id" foreign="id"/>
        </foreign-key>
    </table>

    <table name="borrower_profiles" phpName="Profile" namespace="Borrower">
        <column name="borrower_id" type="INTEGER" primaryKey="true"/>
        <column name="about_me" type="LONGVARCHAR" required="false"/>
        <column name="about_business " type="LONGVARCHAR" required="false"/>
        <column name="address" type="LONGVARCHAR" required="true"/>
        <column name="address_instruction" type="LONGVARCHAR" required="true"/>
        <column name="village" type="VARCHAR" size="100" required="true"/>
        <column name="national_id_number" type="VARCHAR" size="100" required="true"/>
        <column name="phone_number" type="VARCHAR" size="45" required="true"/>
        <column name="alternate_phone_number" type="VARCHAR" size="45" required="true"/>
        <behavior name="timestampable" />
        <foreign-key foreignTable="borrowers">
            <reference local="borrower_id" foreign="id"/>
        </foreign-key>
    </table>

    <table name="lender_profiles" phpName="Profile" namespace="Lender">
        <column name="lender_id" type="INTEGER" primaryKey="true"/>
        <column name="about_me" type="LONGVARCHAR" />
        <behavior name="timestampable" />
        <foreign-key foreignTable="lenders">
            <reference local="lender_id" foreign="id"/>
        </foreign-key>
    </table>

    <table name="loan_stages" phpName="Stage" namespace="Loan">
        <column name="id" type="INTEGER" required="true" primaryKey="true" autoIncrement="true"/>
        <column name="loan_id" type="INTEGER" required="true"/>
        <column name="borrower_id" type="INTEGER" required="true"/>
        <column name="status" type="ENUM" valueSet="0, 1, 2, 3, 5, 6, 7" required="true"/>
        <column name="start_date" type="TIMESTAMP" required="true"/>
        <column name="end_date" type="TIMESTAMP" required="false"/>
        <behavior name="timestampable" />
        <foreign-key foreignTable="loans">
            <reference local="loan_id" foreign="id"/>
        </foreign-key>
        <foreign-key foreignTable="borrowers">
            <reference local="borrower_id" foreign="id"/>
        </foreign-key>
    </table>

    <table name="transactions" phpName="Transaction" namespace="Balance">
        <column name="id" type="INTEGER" required="true" primaryKey="true" autoIncrement="true"/>
        <column name="user_id" type="INTEGER" required="true" phpType="string"/>
        <column name="amount" type="DECIMAL" size="12" scale="4" required="true"/>
        <column name="description" type="VARCHAR" size="100" required="true"/>
        <column name="loan_id" type="INTEGER"/>
        <column name="transaction_date" type="TIMESTAMP" required="true"/>
        <column name="conversion_rate" type="DECIMAL" size="10" scale="4"/>
        <column name="type" type="ENUM" valueSet="1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18" required="true"/>
        <column name="sub_type" type="ENUM" valueSet="1,2,3,4,5,6,7,8,9,10,11,12,13,14"/>
        <column name="loan_bid_id" type="INTEGER"/> <!--To, change to require=true-->
        <behavior name="timestampable" />
        <foreign-key foreignTable="users">
            <reference local="user_id" foreign="id"/>
        </foreign-key>
        <foreign-key foreignTable="loans">
            <reference local="loan_id" foreign="id"/>
        </foreign-key>
        <index name="loan_id">
            <index-column name="loan_id" />
        </index>
        <index name="user_id">
            <index-column name="user_id" />
        </index>
        <index name="loan_bid_id">
            <index-column name="loan_bid_id" />
        </index>
        <index name="transaction_date">
            <index-column name="transaction_date" />
        </index>
        <index name="type">
            <index-column name="type" />
        </index>
        <index name="sub_type">
            <index-column name="sub_type" />
        </index>
    </table>

    <table name="comments" phpName="Comment" namespace="Comment">
        <column name="id" type="INTEGER" autoIncrement="true" primaryKey="true"></column>
        <column name="user_id" type="INTEGER" required="false"></column>
        <column name="borrower_id" type="INTEGER" required="true"></column>
        <column name="message" type="LONGVARCHAR"></column>
        <column name="message_translation" type="LONGVARCHAR" required="false"></column>
        <column name="translator_id" type="INTEGER" required="false"></column>
        <column name="parent_id" type="INTEGER" required="false"></column>
        <column name="root_id" type="INTEGER" required="false"></column>
        <column name="level" type="INTEGER" required="true"></column>
        <behavior name="timestampable" />
        <foreign-key foreignTable="users" phpName="User">
            <reference local="user_id" foreign="id"/>
        </foreign-key>
        <foreign-key foreignTable="borrowers">
            <reference local="borrower_id" foreign="id"/>
        </foreign-key>
        <foreign-key foreignTable="comments">
            <reference local="parent_id" foreign="id"/>
        </foreign-key>
        <foreign-key foreignTable="users" phpName="Translator">
            <reference local="translator_id" foreign="id"/>
        </foreign-key>
    </table>

    <table name="uploads" phpName="Upload" namespace="Upload">
        <column name="id" type="INTEGER" autoIncrement="true" primaryKey="true"></column>
        <column name="extension" type="VARCHAR" required="true"></column>
        <column name="user_id" type="INTEGER" required="true" ></column>
        <column name="type" type="VARCHAR" required="true"></column>
        <column name="mime_type" type="VARCHAR" required="true"></column>
        <behavior name="timestampable"/>
        <foreign-key foreignTable="users" phpName="User">
            <reference local="user_id" foreign="id"/>
        </foreign-key>
    </table>

    <table name="comment_upload" namespace="Comment" isCrossRef="true">
        <column name="comment_id" type="INTEGER" required="true" primaryKey="true"></column>
        <column name="upload_id" type="INTEGER" required="true" primaryKey="true"></column>
        <foreign-key foreignTable="comments" phpName="Comment">
            <reference local="comment_id" foreign="id"/>
        </foreign-key>
        <foreign-key foreignTable="uploads" phpName="Upload">
            <reference local="upload_id" foreign="id"/>
        </foreign-key>
    </table>

    <table name="borrower_upload" namespace="Borrower" isCrossRef="true">
        <column name="borrower_id" type="INTEGER" required="true" primaryKey="true"></column>
        <column name="upload_id" type="INTEGER" required="true" primaryKey="true"></column>
        <foreign-key foreignTable="borrowers" phpName="Borrower">
            <reference local="borrower_id" foreign="id"/>
        </foreign-key>
        <foreign-key foreignTable="uploads" phpName="Upload">
            <reference local="upload_id" foreign="id"/>
        </foreign-key>
    </table>

    <table name="exchange_rates" phpName="ExchangeRate" namespace="Currency">
        <column name="id" type="INTEGER" required="true" primaryKey="true" autoIncrement="true"/>
        <column name="rate" type="DECIMAL" size="10" scale="5" required="true" phpType="string"/>
        <column name="start_date" type="TIMESTAMP"/>
        <column name="end_date" type="TIMESTAMP"/>
        <column name="currency_code" type="VARCHAR" size="3" required="true"/>
    </table>

    <table name="settings" phpName="Setting" namespace="Admin">
        <column name="name" type="VARCHAR" size="45" required="true" primaryKey="true"/>
        <column name="value" type="VARCHAR" size="45" required="true" defaultValue="0"/>
    </table>

    <table name="installments" phpName="Installment" namespace="Repayment">
        <column name="id" type="INTEGER" required="true" primaryKey="true" autoIncrement="true"/>
        <column name="borrower_id" type="INTEGER" required="true"/>
        <column name="loan_id" type="INTEGER" required="true"/>
        <column name="due_date" type="TIMESTAMP"/>
        <column name="amount" type="DECIMAL" size="10" scale="2" phpType="string"/>
        <column name="paid_date" type="TIMESTAMP"/>
        <column name="paid_amount" type="DECIMAL" size="10" scale="2" phpType="string"/>
        <foreign-key foreignTable="loans">
            <reference local="loan_id" foreign="id"/>
        </foreign-key>
        <foreign-key foreignTable="borrowers">
            <reference local="borrower_id" foreign="id"/>
        </foreign-key>
    </table>
</database>
